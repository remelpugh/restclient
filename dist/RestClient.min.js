!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.RestClient=e()}}(function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var p=new Error("Cannot find module '"+o+"'");throw p.code="MODULE_NOT_FOUND",p}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t){var n=e("./HttpMethod"),r=e("./Utilities"),i=e("./OptionsNotSuppliedException"),s=function(){function e(e){this.cache=window.localStorage,this.utils=r;var t=e;if(_.isUndefined(e))throw new i;this.config=t.config,this.headers=t.headers||[],this.queryString=t.queryString||{},this.schema=t.schema||{},this.parseSchema()}return e.prototype.ajax=function(t,r,i){var s=this;void 0===i&&(i={});var o,a,u=this.config.cacheData,p=n[r.toUpperCase()];u&&(o="RestClient_"+t),_.isEmpty(i.schemaDefinition)||(a=this.schema[i.schemaDefinition]),_.isUndefined(i.headers)&&(i.headers=[]);var c=function(e){var t=!_.isUndefined(a),n=JSON.parse(e);if(t&&("function"==typeof a.parse&&(n=a.parse(n)),"undefined"!=typeof a.sort&&_.isArray(n))){var r=a.sort;_.isArray(r)||(r=[r]),_.each(r,function(e){n.sort(function(t,n){var r="asc"===e.direction.toLowerCase()?1:-1,i=e.field.split("."),s=function(e,t){return e[t]};return _.each(i,function(e){t=s(t,e),n=s(n,e)}),n>t?-1*r:t>n?r:0})})}return n};return new Promise(function(n,h){var f,d={};if(f=i.headers.concat(s.headers).concat(a.headers||[]),_.defaults(d,s.queryString),_.defaults(d,a.queryString),_.defaults(d,i.queryString),i.headers=_.uniq(f,"name"),i.queryString=d,u)try{return void n(c(s.cache.getItem(o)))}catch(l){}e.ajax(t,r,i).then(function(e){try{s.config.cacheData&&1===p&&s.cache.setItem(o,e),n(c(e))}catch(t){h({errors:["Invalid JSON: "+t.message]})}}).error(function(e){h(e)})})},e.prototype.get=function(e,t){return void 0===t&&(t={}),this.ajax(this.getUri(e),n[1],t)},e.prototype.post=function(e,t,r){void 0===r&&(r={});var i;return i={data:JSON.stringify(t)},_.defaults(r,i),this.ajax(this.getUri(e),n[2],r)},e.prototype.put=function(e,t,r){void 0===r&&(r={});var i;return i={data:JSON.stringify(t)},_.defaults(r,i),this.ajax(this.getUri(e),n[3],r)},e.prototype.remove=function(e,t,r){void 0===r&&(r={});var i;return i={data:JSON.stringify(t)},_.defaults(r,i),this.ajax(this.getUri(e),n[0],r)},e.prototype.updateSchema=function(e){var t=this,n=_.keys(this.schema),r=_.keys(e),i=_.difference(n,r);_.each(i,function(e){delete t[e]}),this.schema=e,this.parseSchema()},e.ajax=function(t,i,s){void 0===s&&(s={});var o,a=n[i.toUpperCase()];return _.defaults(s,e.defaults.AjaxOptions),_.isEmpty(s.data)||1!==a||(o=r.serialize(s.data),!_.isUndefined(o)&&o.length>0&&(t=t+(t.indexOf("?")>=0?"":"?")+o)),_.isEmpty(s.queryString)||(o=r.serialize(s.queryString),!_.isUndefined(o)&&o.length>0&&(t=t+(t.indexOf("?")>=0?"&":"?")+o)),new Promise(function(n,r){var o,u=e.createXmlHttpRequest(i,t);if(_.isNull(u))return void r(new Error("Failed to create a connection to the server."));u.onerror=function(){o={errors:["Unable to send request to "+t]},r(o)},u.onload=function(){var e=u.status;switch(e){case 500:o={errors:["Unexpected error."]},r(o);break;case 404:o={errors:["Endpoint not found: "+t]},r(o);break;case 400:try{o=JSON.parse(u.responseText)}catch(i){o={errors:["Unexpected error."]}}r(o);break;default:(e>=200&&299>=e||304===e)&&n(u.response)}},_.isEmpty(s.contentType)||u.setRequestHeader("content-type",s.contentType);var p=s.headers;_.isEmpty(p)||_.each(p,function(e){u.setRequestHeader(e.name,e.value)}),u.send(1===a?null:s.data)})},e.createXmlHttpRequest=function(e,t){var n=new XMLHttpRequest;return _.has(n,"withCredentials")?n.open(e,t,!0):_.isUndefined(XDomainRequest)?n=null:(n=new XDomainRequest,n.open(e,t,!0)),n},e.get=function(t,r){return void 0===r&&(r={}),e.ajax(t,n[1],r)},e.post=function(t,r){return void 0===r&&(r={}),e.ajax(t,n[2],r)},e.put=function(t,r){return void 0===r&&(r={}),e.ajax(t,n[3],r)},e.remove=function(t,r){return void 0===r&&(r={}),e.ajax(t,n[0],r)},e.prototype.getUri=function(e){return _.isString(e)?0===e.indexOf("/")?this.config.baseApiUri+e:e:_.isObject(e)?this.config.baseApiUri+e.url:this.config.baseApiUri},e.prototype.parseSchema=function(){var e=this,t=this.schema;void 0!==t&&null!==t&&_.each(t,function(t,r){var i,s=t.args||[],o=t.method||"GET",a=[],u=[],p=e.getUri(t);if(i=n[o.toUpperCase()],0===s.length){var c;switch(a.push('	var url = "'+p+'";\n'),a.push("	var options = {\n"),a.push('		"schemaDefinition": "'+r+'"\n'),a.push("	};\n\n"),u.push("	if (!_.isUndefined(arguments[0]) && !_.isObject(arguments[0])) {\n"),u.push("		options.data = arguments[1];\n"),u.push('		url += "/" + arguments[0];\n'),u.push("	}\n"),u.push("	else if (_.isObject(arguments[0])) {\n"),u.push("		options.data = arguments[0];\n"),u.push("	}\n"),c=a.slice(0),c.push(u.join("")),i){case 0:c.push("\n	return this.remove(url, options);");break;case 2:c.push("\n	var data = options.data;\n"),c.push("\n	delete options.data;\n"),c.push("\n	return this.post(url, data, options);");break;case 3:c.push("\n	var data = options.data;\n"),c.push("\n	delete options.data;\n"),c.push("\n	return this.put(url, data, options);");break;default:c.push("\n	return this.get(url, options);")}if(_.has(e,r)&&delete e[r],e[r]=new Function("id",c.join("")),t.autoGenerateCrud===!0){var h,f,d,l=r.charAt(0).toUpperCase()+r.substring(1),g="delete"+l,v="post"+l,m="put"+l;h=a.slice(0),f=a.slice(0),d=a.slice(0),h.push(u.join("")),h.push("return this.remove(url, data, options);\n"),f.push("return this.post(url, data, options);\n"),d.push(u.join("")),d.push("return this.put(url, data, options);\n"),_.has(e,g)&&delete e[g],_.has(e,v)&&delete e[v],_.has(e,m)&&delete e[m],e["delete"+l]=new Function("id",h.join("")),e["post"+l]=new Function("data",f.join("")),e["put"+l]=new Function("id, data",d.join(""))}}else{var y,x=[],U=p.match(/\{\d\}/g),j=U?U.length:0,S="",w=new RegExp("\\{\\d\\}");if(j<=s.length)for(var O=0;j>O;O+=1)x.push(s.shift());if(_.each(s,function(e){S.length>0&&(S+=", "),S+=e}),y=x.length>0,a.push('	var url = "'+p+'";\n'),a.push("	var options = {\n"),s.length>0){var E=[];a.push('		"data": {\n'),_.each(s,function(e,t){var n=y?t+j:t,r=e;E.length>0&&E.push(",\n"),E.push('			"'+r+'": arguments['+n+"]")}),a.push(E.join("")),a.push("\n		},"),a.push("\n")}a.push('		"schemaDefinition": "'+r+'"'),a.push("\n	};\n"),w.test(p)&&(a.push("	var args = [url];\n"),a.push("	var filteredArgs = [];\n"),a.push("	var passedArgs = Array.prototype.slice.call(arguments);\n\n"),a.push("	for (var i = 0; i < "+j+"; i += 1) {\n"),a.push("		filteredArgs.push(passedArgs.shift());\n"),a.push("	}\n"),a.push("	args = args.concat(filteredArgs);\n"),a.push("	url = utils.formatString.apply(null, args);\n\n")),a.push('	return this.ajax(url, "'+n[i]+'", options);'),_.has(e,r)&&delete e[r],e[r]=new Function(S,a.join(""))}})},e.test="TEST",e.defaults={AjaxOptions:{contentType:"application/json"}},e}();t.exports=s},{"./HttpMethod":3,"./OptionsNotSuppliedException":4,"./Utilities":5}],2:[function(e,t){var n=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.exports=n},{}],3:[function(e,t){var n;!function(e){e[e.DELETE=0]="DELETE",e[e.GET=1]="GET",e[e.POST=2]="POST",e[e.PUT=3]="PUT"}(n||(n={})),t.exports=n},{}],4:[function(e,t){var n=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},r=e("./Exception"),i=function(e){function t(){e.call(this,"Options must be supplied.")}return n(t,e),t}(r);t.exports=i},{"./Exception":2}],5:[function(e,t){var n;!function(e){e.formatString=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i,s,o=e;for(i=t.length,r=0;i>r;r+=1){var a=t[r];s=new RegExp("\\{(\\s)?"+r+"(\\s)?\\}","gi"),o=o.replace(s,a)}return o},e.serialize=function(e){if(!_.isObject(e))return e;if(_.isNull(e)||_.isUndefined(e))return"";var t=[];return _.each(e,function(e,n){if(!_.isUndefined(e)){var r=encodeURIComponent(n)+"=";r+=encodeURIComponent(_.isObject(e)?JSON.stringify(e):e),t.push(r)}}),t.join("&")}}(n||(n={})),t.exports=n},{}]},{},[1])(1)});