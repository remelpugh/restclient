!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.RestClient=e()}}(function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var p=new Error("Cannot find module '"+o+"'");throw p.code="MODULE_NOT_FOUND",p}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){var r=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.exports=r},{}],2:[function(e,t,n){var r;!function(e){e[e.DELETE=0]="DELETE",e[e.GET=1]="GET",e[e.POST=2]="POST",e[e.PUT=3]="PUT"}(r||(r={})),t.exports=r},{}],3:[function(e,t,n){var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./Exception"),s=function(e){function t(){e.call(this,"Options must be supplied.")}return r(t,e),t}(i);t.exports=s},{"./Exception":1}],4:[function(e,t,n){var r=e("./HttpMethod"),i=e("./Utilities"),s=e("./OptionsNotSuppliedException"),o=function(){function e(e){this.cache=window.localStorage,this.utils=i;var t=e;if(_.isUndefined(e))throw new s;this.config=t.config,this.headers=t.headers||[],this.queryString=t.queryString||{},this.schema=t.schema||{},this.parseSchema()}return e.prototype.ajax=function(t,n,i){var s=this;void 0===i&&(i={});var o,a,u=this.config.cacheData,p=r[n.toUpperCase()];u&&(o="RestClient_"+t),_.isEmpty(i.schemaDefinition)||(a=this.schema[i.schemaDefinition]),_.isUndefined(i.headers)&&(i.headers=[]);var c=function(e){var t=!_.isUndefined(a),n=JSON.parse(e);if(t&&("function"==typeof a.parse&&(n=a.parse(n)),"undefined"!=typeof a.sort&&_.isArray(n))){var r=a.sort;_.isArray(r)||(r=[r]),_.each(r,function(e){n.sort(function(t,n){var r="asc"===e.direction.toLowerCase()?1:-1,i=e.field.split("."),s=function(e,t){return e[t]};return _.each(i,function(e){t=s(t,e),n=s(n,e)}),n>t?-1*r:t>n?r:0})})}return n};return new Promise(function(h,f){var d,l={};if(d=i.headers.concat(s.headers).concat(a.headers||[]),_.defaults(l,s.queryString),_.defaults(l,a.queryString),_.defaults(l,i.queryString),i.headers=_.uniq(d,"name"),i.queryString=l,u)try{return void h(c(s.cache.getItem(o)))}catch(g){}e.ajax(t,n,i).then(function(e){try{s.config.cacheData&&p===r.GET&&s.cache.setItem(o,e),h(c(e))}catch(t){f({errors:["Invalid JSON: "+t.message]})}}).error(function(e){f(e)})})},e.prototype.get=function(e,t){return void 0===t&&(t={}),this.ajax(this.getUri(e),r[r.GET],t)},e.prototype.post=function(e,t,n){void 0===n&&(n={});var i;return i={data:JSON.stringify(t)},_.defaults(n,i),this.ajax(this.getUri(e),r[r.POST],n)},e.prototype.put=function(e,t,n){void 0===n&&(n={});var i;return i={data:JSON.stringify(t)},_.defaults(n,i),this.ajax(this.getUri(e),r[r.PUT],n)},e.prototype.remove=function(e,t,n){void 0===n&&(n={});var i;return i={data:JSON.stringify(t)},_.defaults(n,i),this.ajax(this.getUri(e),r[r.DELETE],n)},e.prototype.updateSchema=function(e){var t=this,n=_.keys(this.schema),r=_.keys(e),i=_.difference(n,r);_.each(i,function(e){delete t[e]}),this.schema=e,this.parseSchema()},e.ajax=function(t,n,s){void 0===s&&(s={});var o,a=r[n.toUpperCase()];return _.defaults(s,e.defaults.AjaxOptions),_.isEmpty(s.data)||a!==r.GET||(o=i.serialize(s.data),!_.isUndefined(o)&&o.length>0&&(t=t+(t.indexOf("?")>=0?"":"?")+o)),_.isEmpty(s.queryString)||(o=i.serialize(s.queryString),!_.isUndefined(o)&&o.length>0&&(t=t+(t.indexOf("?")>=0?"&":"?")+o)),new Promise(function(i,o){var u,p=e.createXmlHttpRequest(n,t);if(_.isNull(p))return void o(new Error("Failed to create a connection to the server."));p.onerror=function(){u={errors:["Unable to send request to "+t]},o(u)},p.onload=function(){var e=p.status;switch(e){case 500:u={errors:["Unexpected error."]},o(u);break;case 404:u={errors:["Endpoint not found: "+t]},o(u);break;case 400:try{u=JSON.parse(p.responseText)}catch(n){u={errors:["Unexpected error."]}}o(u);break;default:(e>=200&&299>=e||304===e)&&i(p.response)}},_.isEmpty(s.contentType)||p.setRequestHeader("content-type",s.contentType);var c=s.headers;_.isEmpty(c)||_.each(c,function(e){p.setRequestHeader(e.name,e.value)}),p.send(a===r.GET?null:s.data)})},e.createXmlHttpRequest=function(e,t){var n=new XMLHttpRequest;return _.has(n,"withCredentials")?n.open(e,t,!0):n=null,n},e.get=function(t,n){return void 0===n&&(n={}),e.ajax(t,r[r.GET],n)},e.post=function(t,n){return void 0===n&&(n={}),e.ajax(t,r[r.POST],n)},e.put=function(t,n){return void 0===n&&(n={}),e.ajax(t,r[r.PUT],n)},e.remove=function(t,n){return void 0===n&&(n={}),e.ajax(t,r[r.DELETE],n)},e.prototype.getUri=function(e){return _.isString(e)?0===e.indexOf("/")?this.config.baseApiUri+e:e:_.isObject(e)?this.config.baseApiUri+e.url:this.config.baseApiUri},e.prototype.parseSchema=function(){var e=this,t=this.schema;void 0!==t&&null!==t&&_.each(t,function(t,n){var i,s=t.args||[],o=t.method||"GET",a=[],u=[],p=e.getUri(t);if(i=r[o.toUpperCase()],0===s.length){var c;switch(a.push('	var url = "'+p+'";\n'),a.push("	var options = {\n"),a.push('		"schemaDefinition": "'+n+'"\n'),a.push("	};\n\n"),u.push("	if (!_.isUndefined(arguments[0]) && !_.isObject(arguments[0])) {\n"),u.push("		options.data = arguments[1];\n"),u.push('		url += "/" + arguments[0];\n'),u.push("	}\n"),u.push("	else if (_.isObject(arguments[0])) {\n"),u.push("		options.data = arguments[0];\n"),u.push("	}\n"),c=a.slice(0),c.push(u.join("")),i){case r.DELETE:c.push("\n	return this.remove(url, options);");break;case r.POST:c.push("\n	var data = options.data;\n"),c.push("\n	delete options.data;\n"),c.push("\n	return this.post(url, data, options);");break;case r.PUT:c.push("\n	var data = options.data;\n"),c.push("\n	delete options.data;\n"),c.push("\n	return this.put(url, data, options);");break;default:c.push("\n	return this.get(url, options);")}if(_.has(e,n)&&delete e[n],e[n]=new Function("id",c.join("")),t.autoGenerateCrud===!0){var h,f,d,l=n.charAt(0).toUpperCase()+n.substring(1),g="delete"+l,v="post"+l,m="put"+l;h=a.slice(0),f=a.slice(0),d=a.slice(0),h.push(u.join("")),h.push("return this.remove(url, data, options);\n"),f.push("return this.post(url, data, options);\n"),d.push(u.join("")),d.push("return this.put(url, data, options);\n"),_.has(e,g)&&delete e[g],_.has(e,v)&&delete e[v],_.has(e,m)&&delete e[m],e["delete"+l]=new Function("id",h.join("")),e["post"+l]=new Function("data",f.join("")),e["put"+l]=new Function("id, data",d.join(""))}}else{var y,E=[],x=p.match(/\{\d\}/g),U=x?x.length:0,S="",j=new RegExp("\\{\\d\\}");if(U<=s.length)for(var T=0;U>T;T+=1)E.push(s.shift());if(_.each(s,function(e){S.length>0&&(S+=", "),S+=e}),y=E.length>0,a.push('	var url = "'+p+'";\n'),a.push("	var options = {\n"),s.length>0){var O=[];a.push('		"data": {\n'),_.each(s,function(e,t){var n=y?t+U:t,r=e;O.length>0&&O.push(",\n"),O.push('			"'+r+'": arguments['+n+"]")}),a.push(O.join("")),a.push("\n		},"),a.push("\n")}a.push('		"schemaDefinition": "'+n+'"'),a.push("\n	};\n"),j.test(p)&&(a.push("	var args = [url];\n"),a.push("	var filteredArgs = [];\n"),a.push("	var passedArgs = Array.prototype.slice.call(arguments);\n\n"),a.push("	for (var i = 0; i < "+U+"; i += 1) {\n"),a.push("		filteredArgs.push(passedArgs.shift());\n"),a.push("	}\n"),a.push("	args = args.concat(filteredArgs);\n"),a.push("	url = utils.formatString.apply(null, args);\n\n")),a.push('	return this.ajax(url, "'+r[i]+'", options);'),_.has(e,n)&&delete e[n],e[n]=new Function(S,a.join(""))}})},e.test="TEST",e.defaults={AjaxOptions:{contentType:"application/json"}},e}();t.exports=o},{"./HttpMethod":2,"./OptionsNotSuppliedException":3,"./Utilities":5}],5:[function(e,t,n){var r;!function(e){e.formatString=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i,s,o=e;for(i=t.length,r=0;i>r;r+=1){var a=t[r];s=new RegExp("\\{(\\s)?"+r+"(\\s)?\\}","gi"),o=o.replace(s,a)}return o},e.serialize=function(e){if(!_.isObject(e))return e;if(_.isNull(e)||_.isUndefined(e))return"";var t=[];return _.each(e,function(e,n){if(!_.isUndefined(e)){var r=encodeURIComponent(n)+"=";r+=encodeURIComponent(_.isObject(e)?JSON.stringify(e):e),t.push(r)}}),t.join("&")}}(r||(r={})),t.exports=r},{}]},{},[4])(4)});
//# sourceMappingURL=RestClient.min.js.map